<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="description" content="GGIS on Github : Organization Pages for Gary Dalton and GGIS">

          <meta name="author" content="Gary Dalton">
              <title>RPi Initial Setup Guide</title>
      <style type="text/css">code{white-space: pre;}</style>
      <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
                  <link rel="stylesheet" href="stylesheets/stylesheet.css">
            </head>

<body>
    
    <div id="header_wrap" class="outer">
    <header class="inner">
                <a id="forkme_banner" href="https://github.com/gary-dalton/RaspberryPi-projects/tree/gh-pages">View on GitHub</a>
                        <h1 id="project_title">RPi Initial Setup Guide</h1>
                        <h3 id="project_tagline">Raspberry Pi - Image and Initial Setup</h3>
            </header>
    </div>

    <div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
                <p><a href="index.html">Home</a></p>
<section id="description" class="level1">
<h1>Description</h1>
<p>This guides the user through creation of a MicroSD image and then initial setup of the Raspberry Pi. It is necessary to have either a wired or WiFi network to complete this guide. Once a well functioning and secure Pi is completed, the user will save the image. Notice that a large part of this guide deals with security. Security is a primary concern when connecting things to the Internet.</p>
</section>
<section id="next-up" class="level1">
<h1>Next up?</h1>
<p>After reading this guide, you may be interested in reading:</p>
<ul>
<li><a href="rpi_wifi_ap.html">RPi WiFi Access Point Guide</a></li>
<li><a href="rpi_tor.html">Raspberry Tor</a></li>
<li><a href="rpi_gui_changes.html">RPi Desktop Mods</a>, Changes to the packages and defaults of the full Raspian</li>
</ul>
</section>
<section id="parts-list" class="level1">
<h1>Parts List</h1>
<ul>
<li>Raspberry Pi 2</li>
<li>4GB (or larger) class 10 MicroSD card</li>
<li><a href="http://www.amazon.com/Edimax-EW-7811Un-150Mbps-Raspberry-Supports/dp/B003MTTJOY/ref=pd_bxgy_147_2">USB WiFi dongle</a> <em>(optional)</em></li>
<li><a href="https://www.adafruit.com/product/954">USB to serial console cable</a> <em>(optional)</em></li>
</ul>
</section>
<section id="overview" class="level1">
<h1>Overview</h1>
<ol type="1">
<li><a href="#1">Download the Raspbian image and write it to the microSD.</a></li>
<li><a href="#2">Connect to the Pi.</a></li>
<li><a href="#3">Boot the Pi.</a></li>
<li><a href="#4">Run the initial setup.</a></li>
<li><a href="#5">Connect to the Internet.</a></li>
<li><a href="#6">Update and upgrade the Pi.</a></li>
<li><a href="#7">Install some network magic.</a></li>
<li><a href="#8">Connect to the Pi using SSH.</a></li>
<li><a href="#9">Improving security.</a></li>
<li><a href="#10">Firewalling with iptables.</a></li>
<li><a href="#11">Connect to the Pi using VNC.</a> <em>(optional)</em></li>
<li><a href="#12">Advanced network management with nmcli.</a> <em>(optional)</em></li>
<li><a href="#13">Add the Adafruit Raspberry Pi repository.</a> <em>(optional)</em></li>
<li><a href="#14">Install node.js.</a> <em>(optional)</em></li>
<li><a href="#15">Install occidentalis.</a> <em>(optional)</em></li>
<li><a href="#Conclusion">Conclusion</a>.</li>
</ol>
<p>The estimated time to complete each step is given. This time is for a novice performing the procedures for the first time. If you are familiar with some of the topics or have completed these procedures before, you should expect to use less time.</p>
<p>Not sure where things are on your Pi? Review <a href="http://www.techweekeurope.co.uk/wp/wp-content/gallery/raspberry-pi-b/b__infographic_web.jpg">this diagram</a>.</p>
</section>
<section id="procedures" class="level1">
<h1>Procedures</h1>
<section id="raspbian" class="level2">
<h2><a name="1"></a>Raspbian</h2>
<p><em>Time to complete this is about 1 hour 20 minutes. If you already have an image, the required software, and have done it before it will go much faster.</em></p>
<p>Download the <a href="https://www.raspberrypi.org/downloads/raspbian/">latest version of Raspbian</a>. For general use, download the full version. If you are certain that you want a headless installation with no GUI desktop, download the Lite version. I usually use the Lite version with no desktop.</p>
<p>For the Lite version, a 4Gb MicroSD is likely sufficient but use at least an 8GB card for the full version. The required size of your disk depends a bit on your expected use. In early 2016, the sweet spot in pricing for these cards is 16GB.</p>
<p>Unzip the image and write it to the MicroSD card. On Windows, I use <a href="http://sourceforge.net/projects/win32diskimager/">Win32 Disk Imager</a>. More detailed instructions and instructions for other operating systems may be found on <a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md">Raspberrypi.org's Installing Images</a>.</p>
<p>Insert the MicroSD into the Pi.</p>
</section>
<section id="connect-to-the-pi" class="level2">
<h2><a name="2"></a>Connect to the Pi</h2>
<p><em>Time to complete is about 15 minutes.</em></p>
<p>From the initial boot, there are three ways to connect to the pi.</p>
<ol type="1">
<li>A Raspberry Pi is a computer that may be operated by connecting with a mouse, keyboard, and monitor.</li>
<li>Using SSH over an Ethernet connection. If you are not familiar with SSH, we will review it later in this guide.</li>
<li>Often, I find it easiest to connect to it using the USB to Serial console cable. This allows me to use my main computer's equipment while working on the Pi in a terminal window. See the <a href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-5-using-a-console-cable">Adafruit overiew</a> for full details on using the USB to console cable.
<ul>
<li>If you use the Adafruit guide and wish to install PuTTY, this <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">PuTTY page</a> instead. Also, don't download just the putty.exe but the <strong>A Windows installer for everything except PuTTYtel</strong> instead.</li>
</ul></li>
</ol>
<figure>
<img src="images/USB-console-connect.jpg" alt="USB to console connection" /><figcaption>USB to console connection</figcaption>
</figure>
</section>
<section id="boot-the-pi" class="level2">
<h2><a name="3"></a>Boot the Pi</h2>
<p><em>Time to complete is about 5 minutes.</em></p>
<p>As soon as you insert the USB to console cable into your computer, the Pi will start to boot. If you are using a keyboard and monitor, plug in your power to boot the Pi.</p>
<p>This next set of instructions assumes you are using the USB to console cable.</p>
<ol type="1">
<li>Use PuTTY to connect to the serial COM port of the USB connection</li>
<li>Hit enter to show the login screen</li>
<li>Login using the default user: pi and the default password: raspberry. (We will change these shortly.)</li>
</ol>
<p><strong>Hint</strong>, putty allows easy copy/paste. To copy from the putty session to the clipboard, just highlight the required text using the mouse. To paste into the putty session from the clipboard, press the <em>Shift and Insert</em> keys.</p>
</section>
<section id="run-first-boot-setup" class="level2">
<h2><a name="4"></a>Run first boot setup</h2>
<p><em>Time to complete is about 10 minutes.</em></p>
<p>Start the configuration software to expand the filesystem, change the password, and change the hostname. Enter the configuration with this command, <code>sudo raspi-config</code>.</p>
<ul>
<li>Select and execute <strong>Expand Filesystem</strong></li>
<li>Select and execute <strong>Change User Password</strong></li>
<li>Select and execute <strong>Internationalization Options</strong>
<ul>
<li><strong>Change Locale</strong> to your locale.
<ul>
<li>Use spacebar to select/deselect</li>
<li>Deselect en_GB.UTF-8 UTF-8</li>
<li>Select en_US.UTF-8 UTF-8</li>
<li>OK</li>
<li>Select en_US.UTF-8 UTF-8 as default and then OK</li>
</ul></li>
<li><strong>Change Timezone</strong> to UTC.</li>
</ul></li>
<li>Select <strong>Advanced Options</strong> and select and execute <strong>Hostname</strong>. <em>Pick a unique and easy to remember hostname. This will be used to connect later.</em></li>
<li>Reboot your system <code>sudo reboot now</code>.</li>
</ul>
<p><strong>The pi may be shutdown from the command line with, <code>sudo shutdown now</code>. Wait about a minute and remove power.</strong></p>
</section>
<section id="connect-to-the-internet" class="level2">
<h2><a name="5"></a>Connect to the Internet</h2>
<p><em>Time to complete is about 40 minutes.</em></p>
<section id="ethernet" class="level3">
<h3>Ethernet</h3>
<p>The easiest way to do this is via Ethernet. Check if you are connected with <code>ifconfig eth</code>. From this output, make note of the <strong>inet addr</strong>. This is your Pi's IP address.</p>
</section>
<section id="wifi" class="level3">
<h3>WiFi</h3>
<p>If you do not have an Ethernet connection, you will have to set up your wifi. This procedure assumes you are using a supported wifi USB dongle, are connecting to a simple shared key access point using DHCP, and are not using the GUI desktop to configure your connections. If you are using the full desktop, connect your wifi using the graphical Network Manager. See the <a href="https://wiki.debian.org/WiFi">Debian wiki</a> for an excellent discussion.</p>
<ul>
<li>Before connecting any USB dongle, shutdown the pi</li>
<li><code>sudo nano /etc/network/interfaces</code></li>
<li>Find the section within this file starting with <code>allow hotplug wlan0</code>. Replace that section with the following.</li>
</ul>
<pre><code>auto wlan0
allow-hotplug wlan0
iface wlan0 inet dhcp
    wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</code></pre>
<ul>
<li><code>CTRL-o</code> to save and <code>CTRL-x</code> to exit.</li>
<li><code>sudo nano /etc/wpa_supplicant/wpa_supplicant.conf</code></li>
<li>Add the following to this file (remember to change replace <em>your_wifi_identifier</em> and <em>your_wifi_password</em> with your real values):</li>
</ul>
<pre><code>network={
ssid=&quot;your_wifi_identifier&quot;
psk=&quot;your_wifi_password&quot;
proto=RSN
key_mgmt=WPA-PSK
pairwise=CCMP
auth_alg=OPEN
}</code></pre>
<ul>
<li>Try continuing with these setting but make note that you may need to change the <em>proto</em> or <em>key mgmt</em> values depending on your network. See <code>man wpa_supplicant.conf</code> for more information.</li>
<li>Restart the wifi interface. If your settings are correct, it should automatically connect.</li>
</ul>
<pre><code>sudo ifdown wlan0
sudo ifup wlan0</code></pre>
<ul>
<li>Check that you are connected with <code>ifconfig wlan0</code>. From this output, make note of the <strong>inet addr</strong>. This is your Pi's IP address. Use <code>iwconfig wlan0</code> to see which Access Point you are connected to.</li>
</ul>
</section>
</section>
<section id="update-and-upgrade" class="level2">
<h2><a name="6"></a>Update and upgrade</h2>
<p><em>Time to complete is about 5 minutes. This does not include the amount of time required to upgrade. Upgrading your system may take an hour with a slow connection and many upgrades.</em></p>
<p>It is important to keep your pi's software up to date. This is commonly done using apt-get. The main keywords to know are <em>update</em>, <em>upgrade</em>, <em>install</em>, and <em>remove</em>. So let's make the system current.</p>
<ul>
<li>Update the packages list, <code>sudo apt-get update</code>.</li>
<li>Upgrade software packages to the current version, <code>sudo apt-get upgrade</code>.</li>
<li>Relax, this might take a while. Maybe grab lunch.</li>
</ul>
</section>
<section id="network-magic" class="level2">
<h2><a name="7"></a>Network magic</h2>
<p><em>Time to complete is about 5 minutes.</em></p>
<p>This step does nothing more than make it easier to find your Pi on your network. It uses <em>Zeroconf</em>, provided by <em>Avahi</em> on Linux, <em>Bonjour</em> on Windows, and included in Apple.</p>
<ol type="1">
<li>Install <code>sudo apt-get install avahi-daemon</code>. (<strong>Note,</strong> on recent versions of Raspbian this is already installed and working.)</li>
<li>Your system can now be found at hostname.local, where the hostname is that which you entered back in <em><a href="#4">Run first boot setup</a></em>.</li>
<li>For your Windows machine, download and install <a href="https://support.apple.com/downloads/Bonjour_for_Windows">Bonjour Print Services</a>.</li>
</ol>
</section>
<section id="connect-to-pi-using-ssh" class="level2">
<h2><a name="8"></a>Connect to Pi using SSH</h2>
<p><em>Time to complete is about 30 minutes.</em></p>
<p>SSH is a safe and efficient way to connect to your Pi over the network or the Internet. It is enabled by default but for highest security, I recommend a few configuration changes and installing your own personal keys. This guide assumes you are connecting from Windows or another Linux system. For Windows use <a href="http://www.putty.org/">PuTTY</a> and for Linux use <a href="http://www.openssh.com/">OpenSSH</a>. It may be necessary to install PuTTY but OpenSSH comes installed on Linux.</p>
<ul>
<li>Verify that SSH is enabled, <code>sudo raspi-config</code> then Advanced Options and then SSH. (<strong>Note,</strong> on recent versions of Raspbian this is enabled by default.)</li>
</ul>
<section id="browser" class="level3">
<h3>Browser</h3>
<p>If you are using the Chrome browser, there is an app that makes SSH easy. Add to Chrome by visiting the <a href="https://chrome.google.com/webstore/detail/secure-shell/pnhechapfaindjhompbnflcldabbghjo">Web Store</a>. Once installed, launch it from the <a href="chrome://apps/">apps page</a>.</p>
<ul>
<li>Select a <em>New connection</em></li>
<li>In the free form text box enter a name for your pi connection. I usually give it the same name as my pi.</li>
<li>Username is the user to connect to your pi as. Default it <em>pi</em></li>
<li>Hostname is <em>hostname.local</em> or the IP address you made note of earlier.</li>
<li>Port is 22</li>
<li>Click <em>Connect</em></li>
<li>When done <code>exit</code></li>
</ul>
</section>
<section id="windows" class="level3">
<h3>Windows</h3>
<ol type="1">
<li>Start puTTY</li>
<li>Enter <em>hostname.local</em>, where hostname is from <em>Network magic</em> into the <strong>Host Name (or IP address)</strong> box.
<ul>
<li>If you are not able to connect with <em>hostname.local</em>, try connecting using the IP address instead. If this works, then somehow the network magic is being blocked.</li>
</ul></li>
<li>Save the session if you wish.</li>
<li>The first time you connect, you will get an alert. Click Yes to continue.</li>
<li>Enter your username, default <em>pi</em>, and password.</li>
<li>You are now at the CLI prompt of your pi.</li>
<li>When done, end your session with <code>exit</code>.</li>
</ol>
</section>
<section id="linux" class="level3">
<h3>Linux</h3>
<ol type="1">
<li>Connect using <code>ssh user@hostname.local</code>, where hostname is from <em>6 Network magic</em> and the default user is <em>pi</em>.</li>
<li>The first time you connect, you will get an alert. Enter <strong>yes</strong> to continue.</li>
<li>You are now at the CLI prompt of your pi.</li>
<li>When done, end your session with <code>exit</code>.</li>
</ol>
<p>A good resource is from <a href="https://wiki.archlinux.org/index.php/Secure_Shell">archlinux</a>.</p>
</section>
</section>
<section id="improving-security" class="level2">
<h2><a name="9"></a>Improving security</h2>
<p>Some general rules to security are:</p>
<ul>
<li>Do not use default passwords</li>
<li>Use multifactor authentication</li>
<li>Do not provide shell access unless it is needed</li>
<li>Do not provide services you do not need</li>
<li>Do not needlessly expose services</li>
<li>Apply security patches</li>
<li>Prevent physical access</li>
<li>Use quality cryptology</li>
</ul>
<section id="sshd-configuration" class="level3">
<h3>SSHd configuration</h3>
<p><em>Time to complete is about 5 minutes.</em></p>
<p>There are a few SSHd configuration changes that will improve SSH security. Since SSHd is likely a service you do want to provide and it gives shell access, this is important.</p>
<ul>
<li>Edit the configuration file, <code>sudo nano /etc/ssh/sshd_config</code></li>
<li><p>Change the following:</p>
<pre><code>PermitRootLogin no</code></pre></li>
<li><p>Add the following:</p>
<pre><code>AllowUsers pi
# Even better if you use a non-default user</code></pre></li>
</ul>
</section>
<section id="additional-ssh-configuration" class="level3">
<h3>Additional SSH configuration</h3>
<p>SSH is very important for improved security when connecting to your pi. The <a href="ssh.html">SSH Hints and Advanced</a> provides guidance to some more advanced SSH settings and methods. Some of these are for improved security and should not be considered optional for an Internet connected device.</p>
</section>
</section>
<section id="firewall-with-iptables" class="level2">
<h2><a name="10"></a>Firewall with iptables</h2>
<p>(advanced) At this point, your pi is functional, connected, and reasonably secure. It can be made more secure with iptables which will only allow the types of traffic you permit. See <a href="rpi_iptables">RPi iptables</a> sections 1-3, start through Basic rule set.</p>
</section>
<section id="connect-to-the-pi-using-vnc" class="level2">
<h2><a name="11"></a>Connect to the Pi using VNC</h2>
<p><em>Time to complete is about 20 minutes.</em></p>
<p>(optional) Virtual Network Connection (VNC) is a way to remotely connect to your pi via the network and access the pi's GUI desktop. I usually do not use a VNC but there are circumstances (educational setting, inexperienced users) where it does prove useful. Generally, I connect using the Browser method. Good information from <a href="https://www.raspberrypi.org/documentation/remote-access/vnc/">rasperrypi.org</a>.</p>
<p><strong>NOTE: There are many security problems in current vnc implementations. Permit access to vnc servers on the local network only.</strong></p>
<p>If you feel you need to run an Internet accessible VNC Server, at a minimum, use SSH tunneling for all connections. Also view <a href="https://help.ubuntu.com/community/VNC/Servers">About VNC Servers</a></p>
<ol type="1">
<li>Update your sources, <code>sudo apt-get update</code>.</li>
<li>Install TightVNC Server, <code>sudo apt-get install tightvncserver</code>.</li>
<li>Start the server, <code>vncserver -nolisten tcp -nevershared -dontdisconnect :1</code>.
<ul>
<li>Learn more with <code>man vncserver</code>, <code>man Xvnc</code>, and <code>Xvnc -help</code></li>
</ul></li>
<li>Enter the requested new vnc password, a view-only password is not needed. This will be required from the VNC Viewer we install later.
<ul>
<li>If you later wish to set a different password simply <code>rm .vnc/passwd</code></li>
</ul></li>
<li>Stop the server with <code>vncserver -kill :1</code>.</li>
<li>The vncserver may be setup to run at boot but I do not recommend it.</li>
<li>Update the iptables rule if needed. <a href="rpi_iptables#3">RPi iptables</a>]</li>
</ol>
<section id="connect-from-linux" class="level3">
<h3>Connect from Linux</h3>
<ul>
<li>From the desktop open either <em>Remote Desktop Viewer</em> or the <em>Remmina Remote Desktop Client</em>.
<ul>
<li><code>sudo apt-get install remmina</code></li>
</ul></li>
<li>Change the connection protocol to VNC.</li>
<li>Connect to <em>hostname.local:1</em>.</li>
<li>Enter the vnc password.</li>
<li>When done, just close the window.</li>
</ul>
</section>
<section id="connect-from-a-browser" class="level3">
<h3>Connect from a browser</h3>
<p>Browser based VNC makes it easy for anyone to use this technology. I use the Google Chrome App from <a href="https://www.realvnc.com/products/chrome/">RealVNC</a>.</p>
<ul>
<li>From the RealVNC page click <em>available in the chrome web store</em></li>
<li>Add to Chrome</li>
<li>Launch the extension from Chrome Apps</li>
<li>Enter the address, <em>hostname.local:1</em></li>
<li>Click <em>Connect</em></li>
<li>Enter the vnc password.</li>
<li>When done, just close the window.</li>
</ul>
</section>
<section id="connect-from-windows" class="level3">
<h3>Connect from Windows</h3>
<ol type="1">
<li>Download the <a href="http://www.tightvnc.com/download.php">TightVNC installer</a>.</li>
<li>Start the installer and choose <strong>Custom Setup</strong>.</li>
<li>From Custom Setup, use the pull-down next to TightVNC Server to have <strong>Entire feature will be unavailable</strong>.</li>
<li>Start the <em>Tight VNC Viewer</em>.</li>
<li>Connect to the Remote Host, <em>hostname.local:1</em>.</li>
<li>When done, just close the window.</li>
</ol>
</section>
</section>
<section id="networkmanager-cli-advanced" class="level2">
<h2><a name="12"></a>NetworkManager CLI (advanced)</h2>
<p>Moved to <a href="rpi_nmcli.html">RPi NetworkManager CLI</a>.</p>
</section>
<section id="add-the-adafruit-raspberry-pi-repository" class="level2">
<h2><a name="13"></a>Add the Adafruit Raspberry Pi repository</h2>
<p>(optional) The <a href="https://learn.adafruit.com/apt-adafruit-com/overiew">Adafruit repository</a> provides access to the most recent node packages and to a few other goodies useful to makers.</p>
<ol type="1">
<li>Become root, <code>sudo -i</code>.</li>
<li>Add the repository to the sources file, <code>echo &quot;deb http://apt.adafruit.com/raspbian/ release main&quot; &gt;&gt; /etc/apt/sources.list</code>. Replace <em>release</em> with the current stable release. In Jan2016, it is jessie.</li>
<li>Add the repository key, <code>wget -O - -q https://apt.adafruit.com/apt.adafruit.com.gpg.key | apt-key add -</code>.</li>
<li><code>apt-get update</code>.</li>
<li>Exit root, <code>exit</code>.</li>
</ol>
</section>
<section id="install-node.js" class="level2">
<h2><a name="14"></a>Install node.js</h2>
<p>(optional) Node.js is a JavaScript runtime environment for developing server-side Web applications. It uses an asynchronous event driven framework that is designed to build scalable network applications. I install it on nearly all of my pi to provide a framework for building user interfaces that can actually do something. <em>(requires Adafruit Raspberry Pi repository)</em></p>
<ol type="1">
<li>Update, <code>sudo apt-get update</code>.</li>
<li>Install node, <code>sudo apt-get install node</code>.</li>
<li>Now go learn more about node from <a href="https://nodejs.org/en/">Node</a>, <a href="http://expressjs.com/en/starter/hello-world.html">Express</a>, <a href="https://learn.adafruit.com/node-embedded-development/events">Adafruit</a>, and <a href="https://www.google.com/webhp?q=node.js%20raspberry%20pi">search</a>.</li>
</ol>
<hr />
</section>
<section id="install-occidentalis" class="level2">
<h2><a name="15"></a>Install occidentalis</h2>
<p>(optional) Occidentalis is a collection of drivers, configuration utilities, and other useful things for single-board computers from <a href="https://github.com/adafruit/Adafruit-Occidentalis">Adafruit</a>. <em>(requires Adafruit Raspberry Pi repository)</em></p>
<ol type="1">
<li>Update, <code>sudo apt-get update</code>.</li>
<li>Install occidentalis, <code>sudo apt-get install occidentalis</code>.</li>
</ol>
<hr />
</section>
</section>
<section id="save-the-image-to-a-file" class="level1">
<h1><a name="Conclusion"></a>Save the image to a file</h1>
<p>Now that you have spent all this time getting your Raspberry Pi set up just so, <strong>save it to an image</strong> for easy reuse. You will still have to change things like usernames, passwords, and hostnames.</p>
<p>Instead of writing a file image to the MicroSD, use the same software to read the MicroSD to a file image. Then when you are ready to spin up your next pi, it will be as easy as, well, pie.</p>
</section>
            </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
    <footer class="inner">
        <p>Published with <a href="http://pandoc.org/">Pandoc</a> onto
        <a href="https://pages.github.com">GitHub Pages</a></p>
    </footer>
    </div>

</body>
</html>
