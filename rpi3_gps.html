<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="description" content="Installation and basic use of the Adafruit Ultimate GPS breakout on a Raspberry Pi 3. The installation starts with GPS over USB but, after running some tests, moves the GPS to UART. Mostly follows https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi">
<meta name="keywords" content="gps, uart, installation, adafruit, raspberrypi">
<meta name="author" content="Gary Dalton">
<title>GPS on Raspberry Pi 3</title>
<link rel="stylesheet" href="stylesheets/github.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="stylesheets/coderay-asciidoctor.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>GPS on Raspberry Pi 3</h1>
<div class="details">
<span id="author" class="author">Gary Dalton</span><br>
<span id="revnumber">version 1.0,</span>
<span id="revdate">13 October 2016</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_parts_list">Parts List</a></li>
<li><a href="#_gps_breakout">GPS Breakout</a></li>
<li><a href="#_gps_daemon_gpsd">GPS daemon (gpsd)</a></li>
<li><a href="#_gps_using_usb_to_tll">GPS using USB to TLL</a>
<ul class="sectlevel2">
<li><a href="#_connections">Connections</a></li>
<li><a href="#_which_usb">Which USB</a></li>
<li><a href="#_gpsd_and_test">gpsd and test</a></li>
</ul>
</li>
<li><a href="#_gps_over_uart">GPS over UART</a>
<ul class="sectlevel2">
<li><a href="#_connections_2">Connections</a></li>
<li><a href="#_edit_boot_cmdline_txt">Edit /boot/cmdline.txt</a></li>
<li><a href="#_disable_the_serial_getty_service">Disable the serial getty service</a></li>
<li><a href="#_force_the_cpu_into_a_fixed_frequency">Force the CPU into a fixed frequency</a></li>
<li><a href="#_connect_gpsd_to_uart_and_test">Connect gpsd to UART and test</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="index.html">Raspberry Pi Projects</a> | <a href="https://gary-dalton.github.io/">Home</a></p>
</div>
<div class="paragraph">
<p>Installation and basic use of the Adafruit Ultimate GPS breakout on a Raspberry Pi 3. The installation starts with GPS over USB but, after running some tests, moves the GPS to UART. Mostly follows <a href="https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi" class="bare">https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/gary-dalton/RaspberryPi-projects/tree/gh-pages">View on GitHub <span class="image"><img src="images/GitHub-Mark-32px.png" alt="GitHub Mark 32px"></span></a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requirements">Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide will start with a basic Raspbian build, connected to a wired network. Follow the <a href="rpi_initial_setup.html">RPi Initial Setup Guide</a> to get started. A Raspberry Pi 3 may be required for these procedures to work. A Raspberry Pi 2 can use this guide provided that it uses only the USB to TLL Serial cable connection. The UART connection method shown in this guide requires a pi 3.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_parts_list">Parts List</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Raspberry Pi 3</p>
</li>
<li>
<p>16GB (or larger) class 10 MicroSD card</p>
</li>
<li>
<p>GPS breakout (<a href="https://www.adafruit.com/product/746">Adafruit Ultimate GPS Breakout - 66 channel w/10 Hz updates - Version 3</a>)</p>
</li>
<li>
<p>USB to TLL Serial cable (<a href="https://www.adafruit.com/products/954" class="bare">https://www.adafruit.com/products/954</a>)</p>
</li>
<li>
<p>RTC module (included in the GPS breakout)</p>
</li>
<li>
<p>(Optional) <a href="https://www.adafruit.com/products/960">External GPS antenna</a> and <a href="https://www.adafruit.com/products/851">SMA to u.FL adapter cable</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gps_breakout">GPS Breakout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The details of the pinouts, the logging capablities, and other features may be found by looking at the Adafruit references listed at the end of this document.</p>
</div>
<div class="paragraph">
<p>For basic usage, only four pins are used. These are: VIN, GND, TX, AND RX.</p>
</div>
<div class="paragraph">
<p>While the unit is attempting to get a fix, the red LED flashes once every second. Once the unit has a fix, it flashes once every 15 seconds.</p>
</div>
<div class="paragraph">
<p>For the optional antenna, push the adapter cable onto the board located u.FL connector. Then attach the antenna to the adapter cable and place the puck in a good reception area.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Make certain to get the correct adapter cable as RP-SMA and SMA, while they look similar, are threaded opposite.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gps_daemon_gpsd">GPS daemon (gpsd)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>gpsd is a service daemon that monitors one or more GPSes or AIS receivers attached to a host computer through serial or USB ports, making all data on the location/course/velocity of the sensors available to be queried on TCP port 2947 of the host computer. See <a href="http://catb.org/gpsd/" class="bare">http://catb.org/gpsd/</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sudo apt-get install gpsd gpsd-clients python-gps</code></p>
</li>
<li>
<p>Disable the gpsd systemd service.</p>
<div class="ulist">
<ul>
<li>
<p><code>sudo systemctl stop gpsd.socket</code></p>
</li>
<li>
<p><code>sudo systemctl disable gpsd.socket</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now the gpsd needs to be started and pointed at either the USB device or the UART. Using <em>USB to TLL</em> or <em>UART</em> are covered in the next two sections. The commands are shown here for easy reference.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sudo killall gpsd</code></p>
</li>
<li>
<p><strong>USB to TLL</strong> use <code>sudo gpsd /dev/ttyUSB0 -F /var/run/gpsd.sock</code></p>
</li>
<li>
<p><strong>UART</strong> use <code>sudo gpsd /dev/ttyS0 -F /var/run/gpsd.sock</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gps_using_usb_to_tll">GPS using USB to TLL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The USB to TLL cable makes it quick and easy to test the GPS breakout with your pi.</p>
</div>
<div class="sect2">
<h3 id="_connections">Connections</h3>
<div class="paragraph">
<p>Attach the colored wires from the USB to TLL cable to the GPS breakout thusly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red to VIN</p>
</li>
<li>
<p>Black to GND</p>
</li>
<li>
<p>Green to RX</p>
</li>
<li>
<p>White to TX</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Insert the USB part of the cable into the pi.</p>
</div>
</div>
<div class="sect2">
<h3 id="_which_usb">Which USB</h3>
<div class="paragraph">
<p>Determine which USB is being used by the GPS.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List the connected USB devices <code>ls /dev/ttyUSB*</code></p>
<div class="ulist">
<ul>
<li>
<p>Typically you will only see the result of <strong>/dev/ttyUSB0</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>If needed you can list all USB devices with <code>sudo lsusb</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_gpsd_and_test">gpsd and test</h3>
<div class="paragraph">
<p>Point gpsd to the USB device.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sudo killall gpsd</code></p>
</li>
<li>
<p><code>sudo gpsd /dev/ttyUSB0 -F /var/run/gpsd.sock</code></p>
</li>
<li>
<p>Test with <code>cgps</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before testing with cgps, it is good for the unit to have a location fix.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gps_over_uart">GPS over UART</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_connections_2">Connections</h3>
<div class="paragraph">
<p>Attach the colored wires from the USB to TLL cable to the GPS breakout thusly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VIN to 5V GPIO pin 04</p>
</li>
<li>
<p>GND to Ground GPIO pin 06</p>
</li>
<li>
<p>RX to TXD0 GPIO pin 08</p>
</li>
<li>
<p>TX to RXD0 GPIO pin 10</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/pi_gpio_1-12.jpg" alt="pi gpio 1 12"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_edit_boot_cmdline_txt">Edit /boot/cmdline.txt</h3>
<div class="ulist">
<ul>
<li>
<p><code>sudo mv /boot/cmdline.txt /boot/cmdline.txt.orig</code></p>
</li>
<li>
<p><code>sudo nano /boot/cmdline.txt</code> add the line:</p>
<div class="ulist">
<ul>
<li>
<p><code>dwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_disable_the_serial_getty_service">Disable the serial getty service</h3>
<div class="ulist">
<ul>
<li>
<p><code>sudo systemctl stop serial-getty@ttyS0.service</code></p>
</li>
<li>
<p><code>sudo systemctl disable serial-getty@ttyS0.service</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_force_the_cpu_into_a_fixed_frequency">Force the CPU into a fixed frequency</h3>
<div class="ulist">
<ul>
<li>
<p><code>sudo nano /boot/config.txt</code></p>
<div class="ulist">
<ul>
<li>
<p>At bottom add <code>enable_uart=1</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Reboot, <code>sudo reboot now</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_connect_gpsd_to_uart_and_test">Connect gpsd to UART and test</h3>
<div class="ulist">
<ul>
<li>
<p><code>sudo killall gpsd</code></p>
</li>
<li>
<p><code>sudo gpsd /dev/ttyS0 -F /var/run/gpsd.sock</code></p>
</li>
<li>
<p>Test with <code>cgps</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before testing with cgps, it is good for the unit to have a location fix.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.raspberrypi.org/forums/viewtopic.php?p=947968#p947968" class="bare">https://www.raspberrypi.org/forums/viewtopic.php?p=947968#p947968</a></p>
</li>
<li>
<p><a href="https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi" class="bare">https://learn.adafruit.com/adafruit-ultimate-gps-on-the-raspberry-pi</a></p>
</li>
<li>
<p><a href="https://learn.adafruit.com/adafruit-ultimate-gps" class="bare">https://learn.adafruit.com/adafruit-ultimate-gps</a></p>
</li>
<li>
<p><a href="https://cdn-learn.adafruit.com/downloads/pdf/adafruit-ultimate-gps-on-the-raspberry-pi.pdf" class="bare">https://cdn-learn.adafruit.com/downloads/pdf/adafruit-ultimate-gps-on-the-raspberry-pi.pdf</a></p>
</li>
<li>
<p><a href="http://catb.org/gpsd/" class="bare">http://catb.org/gpsd/</a></p>
</li>
<li>
<p><a href="http://www.danmandle.com/blog/getting-gpsd-to-work-with-python/" class="bare">http://www.danmandle.com/blog/getting-gpsd-to-work-with-python/</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0<br>
Last updated 2016-10-17 21:11:32 Central Daylight Time
</div>
</div>
</body>
</html>